# Windows 桌面时钟+天气+待办提醒 项目开发规范应用指南

## 📋 项目概述
本项目是一个集成时钟显示、天气查询和待办事项提醒功能的 Windows 桌面应用程序。

## 📂 已启用的规范文件
本项目已在 `.qoder/rules/` 目录下配置以下规范：

### ✅ 核心规范（必须遵循）
- `requirements-spec.zh-CN.md` - 开发需求规范
- `workflow-spec.zh-CN.md` - 工作流规范
- `naming-conventions.zh-CN.md` - 命名约定

### ✅ 质量规范（强烈推荐）
- `testing-spec.zh-CN.md` - 测试规范
- `security-spec.zh-CN.md` - 安全规范
- `error-handling-spec.zh-CN.md` - 错误处理规范

### ✅ 可选规范（按需应用）
- `api-design-spec.zh-CN.md` - API设计规范（用于天气API对接）
- `git-workflow-spec.zh-CN.md` - Git工作流规范

---

## 🎯 开发待办清单（To-Do List）

### 第一阶段：项目初始化与环境配置

#### ☐ 任务 1.1：创建项目基础结构
**行动步骤：**
1. 创建项目目录结构：`src/`, `tests/`, `config/`, `docs/`
2. 初始化版本控制：`git init`
3. 创建 `.gitignore` 文件，忽略敏感配置和构建输出

**适用规范：**
- 📖 `git-workflow-spec.zh-CN.md` → [规则 11] .gitignore 管理
- 📖 `security-spec.zh-CN.md` → [规则 8] 安全配置管理

---

#### ☐ 任务 1.2：选择技术栈并初始化依赖
**行动步骤：**
1. 选择桌面应用框架（推荐：Electron、.NET WPF、PyQt）
2. 创建 `package.json` / `requirements.txt` / 项目配置文件
3. 仅添加必要的依赖，避免过度引入

**适用规范：**
- 📖 `requirements-spec.zh-CN.md` → [规则 3] 最小化新增依赖
- 📖 `requirements-spec.zh-CN.md` → [规则 13] 只使用真实存在的库
- 📖 `security-spec.zh-CN.md` → [规则 4] 依赖安全管理

---

#### ☐ 任务 1.3：配置环境变量与密钥管理
**行动步骤：**
1. 创建 `.env.example` 文件作为模板
2. 配置天气 API 密钥：`WEATHER_API_KEY=your_api_key_here`
3. 将 `.env` 添加到 `.gitignore`，防止泄露
4. 创建 `config/README.md` 说明配置项用途

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 8] 安全配置管理
- 📖 `naming-conventions.zh-CN.md` → [约定 9] 环境变量命名（使用 UPPER_SNAKE_CASE）

---

#### ☐ 任务 1.4：初始化 Git 分支策略
**行动步骤：**
1. 创建主分支：`main`
2. 创建开发分支：`develop`
3. 根据功能创建特性分支：`feature/clock`, `feature/weather`, `feature/todo-reminder`

**适用规范：**
- 📖 `git-workflow-spec.zh-CN.md` → [规则 1] 分支命名规范
- 📖 `git-workflow-spec.zh-CN.md` → [规则 5] 分支策略（采用 Git Flow）

---

### 第二阶段：核心功能设计与接口定义

#### ☐ 任务 2.1：设计内部服务接口
**行动步骤：**
1. 定义 `ClockService` 接口：获取当前时间、格式化显示
2. 定义 `WeatherService` 接口：`getCurrentWeather(city)`, `getForecast(city, days)`
3. 定义 `TodoService` 接口：`addTask()`, `listTasks()`, `scheduleReminder()`
4. 明确每个接口的输入参数、返回值和错误码

**适用规范：**
- 📖 `api-design-spec.zh-CN.md` → [规则 3] 请求与响应格式
- 📖 `naming-conventions.zh-CN.md` → [约定 2] 函数/方法命名（使用动词）
- 📖 `naming-conventions.zh-CN.md` → [约定 3] 类命名（使用 PascalCase）

---

#### ☐ 任务 2.2：选择并验证天气 API
**行动步骤：**
1. 选择真实可用的天气服务（如 OpenWeatherMap, WeatherAPI, AccuWeather）
2. 阅读 API 文档，验证接口存在性与签名
3. 测试 API 调用，确认返回数据结构
4. 记录 API 限流策略和超时时间

**适用规范：**
- 📖 `requirements-spec.zh-CN.md` → [规则 2] 复用现有代码和 API
- 📖 `requirements-spec.zh-CN.md` → [规则 6] 验证所有 API 是否存在
- 📖 `api-design-spec.zh-CN.md` → [规则 7] 错误处理标准

---

#### ☐ 任务 2.3：定义错误分类与错误码
**行动步骤：**
1. 业务错误：`TODO_INVALID_TIME`, `TODO_DUPLICATE_TASK`
2. 系统错误：`FILE_READ_ERROR`, `DB_CONNECTION_FAILED`
3. 第三方错误：`WEATHER_API_UNAVAILABLE`, `WEATHER_RATE_LIMIT_EXCEEDED`
4. 创建自定义错误类：`WeatherServiceError`, `TodoServiceError`

**适用规范：**
- 📖 `error-handling-spec.zh-CN.md` → [规则 1] 错误分类体系
- 📖 `error-handling-spec.zh-CN.md` → [规则 2] 自定义错误类
- 📖 `error-handling-spec.zh-CN.md` → [规则 10] 错误码标准化

---

#### ☐ 任务 2.4：设计数据存储方案
**行动步骤：**
1. 选择待办事项持久化方案（SQLite、JSON 文件、LocalStorage）
2. 设计数据模型：任务ID、标题、描述、提醒时间、状态
3. 实现数据加密（如包含敏感信息）

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 3] 敏感数据保护
- 📖 `naming-conventions.zh-CN.md` → [约定 7] 数据库表/列命名（如使用 SQL）

---

### 第三阶段：功能实现

#### ☐ 任务 3.1：实现时钟显示模块
**行动步骤：**
1. 创建 `ClockWidget` 组件/类
2. 实现实时时间更新逻辑
3. 支持 12/24 小时制切换
4. 添加单元测试：测试时间格式化、时区处理

**适用规范：**
- 📖 `requirements-spec.zh-CN.md` → [规则 1] 生成完整可运行代码
- 📖 `naming-conventions.zh-CN.md` → [约定 3] 类命名
- 📖 `testing-spec.zh-CN.md` → [规则 1] 测试完整性

---

#### ☐ 任务 3.2：实现天气查询模块
**行动步骤：**
1. 创建 `WeatherService` 类
2. 实现 API 调用逻辑（使用 HTTPS）
3. 添加超时、重试和限流机制
4. 实现缓存策略（避免频繁调用 API）
5. Mock API 进行单元测试：测试成功、超时、限流、无网络场景

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 7] API 安全（速率限制、HTTPS、超时）
- 📖 `error-handling-spec.zh-CN.md` → [规则 6] 错误恢复策略（重试+降级）
- 📖 `error-handling-spec.zh-CN.md` → [规则 11] 超时和限流处理
- 📖 `testing-spec.zh-CN.md` → [规则 4] Mock 和 Stub 使用规范

---

#### ☐ 任务 3.3：实现待办提醒模块
**行动步骤：**
1. 创建 `TodoService` 类
2. 实现任务添加、删除、修改功能
3. 实现提醒调度器（支持定时触发）
4. 实现任务持久化存储
5. 添加输入验证：任务长度、时间格式、字符白名单
6. 测试边界场景：过期任务、重复提醒、跨时区

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 1] 输入验证与清理
- 📖 `error-handling-spec.zh-CN.md` → [规则 5] Try-Catch 最佳实践
- 📖 `testing-spec.zh-CN.md` → [规则 7] 边界条件和异常测试

---

#### ☐ 任务 3.4：实现全局错误处理器
**行动步骤：**
1. 创建全局错误处理器/中间件
2. 统一日志记录：错误类型、时间戳、堆栈信息
3. 生产环境仅显示用户友好提示，隐藏技术细节
4. 将详细错误记录到日志文件

**适用规范：**
- 📖 `error-handling-spec.zh-CN.md` → [规则 3] 错误日志记录
- 📖 `error-handling-spec.zh-CN.md` → [规则 4] 用户友好的错误提示
- 📖 `error-handling-spec.zh-CN.md` → [规则 7] 全局错误处理器
- 📖 `security-spec.zh-CN.md` → [规则 6] 日志安全（不记录密钥、密码）

---

#### ☐ 任务 3.5：实现 UI 界面
**行动步骤：**
1. 创建主窗口组件
2. 集成时钟、天气、待办三个模块
3. 实现用户交互：添加/删除任务、刷新天气
4. 添加错误边界（React）或异常捕获（其他框架）

**适用规范：**
- 📖 `naming-conventions.zh-CN.md` → [约定 6] 组件命名（PascalCase）
- 📖 `error-handling-spec.zh-CN.md` → [规则 8] 前端错误边界

---

### 第四阶段：测试与质量保证

#### ☐ 任务 4.1：编写单元测试
**行动步骤：**
1. 为每个服务类编写单元测试
2. 覆盖率目标：服务层 ≥85%，UI 层 ≥70%
3. 使用 Mock 隔离外部依赖（天气 API、文件系统）
4. 测试命名遵循约定：`WeatherService.test.ts` 或 `test_weather_service.py`

**适用规范：**
- 📖 `testing-spec.zh-CN.md` → [规则 1] 测试完整性
- 📖 `testing-spec.zh-CN.md` → [规则 2] 测试覆盖率目标
- 📖 `testing-spec.zh-CN.md` → [规则 4] Mock 和 Stub 使用规范
- 📖 `testing-spec.zh-CN.md` → [规则 5] 测试命名约定

---

#### ☐ 任务 4.2：编写集成测试
**行动步骤：**
1. 测试天气服务与 API 的真实对接（可选 Mock）
2. 测试提醒模块的调度器与存储交互
3. 测试 UI 与服务层的集成

**适用规范：**
- 📖 `testing-spec.zh-CN.md` → [规则 3] 测试分层策略（集成测试占 20%）

---

#### ☐ 任务 4.3：边界与异常测试
**行动步骤：**
1. 测试无网络场景：天气服务降级到缓存或"当前不可用"
2. 测试 API 密钥失效：显示错误提示，记录日志
3. 测试提醒队列过长：性能测试
4. 测试跨时区和夏令时边界

**适用规范：**
- 📖 `testing-spec.zh-CN.md` → [规则 7] 边界条件和异常测试

---

#### ☐ 任务 4.4：安全审计
**行动步骤：**
1. 运行依赖安全扫描：`npm audit` / `pip-audit`
2. 检查 API 密钥是否硬编码
3. 确认用户输入已验证和清理
4. 确认敏感数据未记录到日志

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 4] 依赖安全管理
- 📖 `security-spec.zh-CN.md` → [规则 8] 安全配置管理
- 📖 `security-spec.zh-CN.md` → [规则 1] 输入验证与清理

---

### 第五阶段：文档与版本管理

#### ☐ 任务 5.1：编写变更日志
**行动步骤：**
1. 创建 `CHANGELOG.md` 文件
2. 按版本记录变更，使用格式：Added/Changed/Removed/Fixed/Security
3. 示例：
   ```
   ## [1.0.0] - 2025-11-11
   ### Added
   - 时钟显示功能，支持 12/24 小时制
   - 天气查询功能，集成 OpenWeatherMap API
   - 待办提醒功能，支持定时弹窗通知
   ```

**适用规范：**
- 📖 `workflow-spec.zh-CN.md` → [规则 1] 变更日志管理

---

#### ☐ 任务 5.2：版本号管理
**行动步骤：**
1. 采用语义化版本：`MAJOR.MINOR.PATCH`
2. 首个发布版本：`v1.0.0`
3. 更新 `package.json` / 项目配置文件中的版本号

**适用规范：**
- 📖 `workflow-spec.zh-CN.md` → [规则 2] 版本号管理

---

#### ☐ 任务 5.3：编写项目文档
**行动步骤：**
1. 创建 `README.md`：项目简介、功能列表、安装步骤、使用说明
2. 创建 `config/README.md`：配置项说明
3. 同步更新文档与代码变更

**适用规范：**
- 📖 `workflow-spec.zh-CN.md` → [规则 6] 文档同步

---

#### ☐ 任务 5.4：提交规范化
**行动步骤：**
1. 提交消息格式：`<type>(<scope>): <subject>`
2. 示例：
   - `feat(clock): add 24-hour format support`
   - `fix(weather): resolve API timeout issue`
   - `test(todo): add reminder scheduling tests`

**适用规范：**
- 📖 `git-workflow-spec.zh-CN.md` → [规则 2] 提交消息规范（Conventional Commits）

---

### 第六阶段：发布与部署

#### ☐ 任务 6.1：构建与打包
**行动步骤：**
1. 配置构建脚本（Electron 打包、.NET 发布、PyQt 打包）
2. 确保构建产物不包含调试信息、密钥
3. 签名应用程序（Windows Authenticode）

**适用规范：**
- 📖 `security-spec.zh-CN.md` → [规则 8] 安全配置管理

---

#### ☐ 任务 6.2：创建发布标签
**行动步骤：**
1. 创建带注释的 Git 标签：
   ```bash
   git tag -a v1.0.0 -m "Release version 1.0.0
   
   Features:
   - 时钟显示
   - 天气查询
   - 待办提醒
   "
   ```
2. 推送标签：`git push origin v1.0.0`

**适用规范：**
- 📖 `git-workflow-spec.zh-CN.md` → [规则 9] 标签管理

---

#### ☐ 任务 6.3：部署前检查清单
**行动步骤：**
- [ ] 所有测试通过
- [ ] 代码覆盖率达标
- [ ] 依赖安全审计通过
- [ ] 文档已更新
- [ ] 变更日志已更新
- [ ] 版本号已提升
- [ ] 无调试代码或 console.log
- [ ] API 密钥未硬编码

**适用规范：**
- 📖 `workflow-spec.zh-CN.md` → [规则 8] 部署前检查清单（可选启用）

---

## 🔧 工具与自动化（可选）

### 规范检查工具
在项目根目录运行以下命令：

```bash
# 规范检查
python tools/spec-lint.py --target-dir ./src

# 合规报告
node tools/spec-report.js --output compliance-report.json
```

### Git Hooks 集成
在 `.git/hooks/pre-commit` 中添加：
```bash
#!/bin/bash
# 运行规范检查
python tools/spec-lint.py --target-dir ./src
if [ $? -ne 0 ]; then
  echo "规范检查失败，请修复后再提交"
  exit 1
fi
```

---

## 📊 规范优先级速查表

| 规范类别 | 优先级 | 适用阶段 |
|---------|-------|---------|
| 开发需求规范 | ⭐⭐⭐ 关键 | 全流程 |
| 命名约定 | ⭐⭐⭐ 高 | 编码阶段 |
| 安全规范 | ⭐⭐⭐ 关键 | 设计+实现 |
| 错误处理规范 | ⭐⭐⭐ 关键 | 设计+实现 |
| 测试规范 | ⭐⭐ 强烈推荐 | 测试阶段 |
| 工作流规范 | ⭐⭐ 推荐 | 全流程 |
| API设计规范 | ⭐ 可选 | 天气API对接 |
| Git工作流规范 | ⭐ 可选 | 版本管理 |

---

## 📞 常见问题与建议

### Q1: 如何处理天气 API 调用失败？
**A:** 遵循 `error-handling-spec.zh-CN.md` [规则 6] 错误恢复策略：
1. 实施重试机制（3次，指数退避）
2. 降级到上次成功缓存
3. 显示"天气服务暂时不可用"

### Q2: 如何确保 API 密钥安全？
**A:** 遵循 `security-spec.zh-CN.md` [规则 8]：
1. 使用环境变量：`process.env.WEATHER_API_KEY`
2. `.env` 文件添加到 `.gitignore`
3. 提供 `.env.example` 作为模板

### Q3: 测试覆盖率目标是多少？
**A:** 遵循 `testing-spec.zh-CN.md` [规则 2]：
- 服务层（天气、提醒逻辑）：≥85%
- UI 层：≥70%
- 集成测试：覆盖核心流程

---

## ✅ 总结

本指南将规范转化为可执行的待办事项，确保您的"Windows 桌面时钟+天气+待办提醒"项目：

1. **质量可靠**：通过测试规范保证功能正确性
2. **安全合规**：防止密钥泄露、输入注入等风险
3. **易于维护**：统一命名、清晰文档、规范化提交
4. **错误友好**：完善的错误处理与用户提示

请按照清单逐项完成，并在每个任务完成后标记 ✅。

---

**版本：** v1.0  
**创建日期：** 2025-11-11  
**适用项目：** Windows Desktop Clock Utility  
